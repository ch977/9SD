function doComment(){var t=$.trim($("#txtContent").val()),n,i;t=t.replace(/(\n){3,}/ig,"\n\n");var r=$("#Comment_new").html(),u=$("#ReplyToCommentId").html(),f=$("#news_title").html();if(t==""){alert("评论不能为空！");return}if(t.length<3){alert("回复的字数太少了，至少3个字吧！");return}$("#btnComment").val("提交中...").attr("disabled","disabled");$("#Comment_new").html("评论提交中...").css("color","red");$("#Comment_Edit_ID").val()==null||$("#Comment_Edit_ID").val()==""?(n={},n.ContentID=ContentID,n.Content=t,n.strComment=r,n.parentCommentId=u,n.title=f,$.ajax({url:"/Comment/InsertComment",data:JSON.stringify(n),type:"post",dataType:"text",contentType:"application/json; charset=utf8",success:function(n){comment_callback(n)},error:function(n){$("#Comment_new").html(n)}})):(i={},i.ContentID=ContentID,i.CommentID=$("#Comment_Edit_ID").val(),i.Content=t,$.ajax({url:"/Comment/UpdateComment",data:JSON.stringify(i),type:"post",dataType:"text",contentType:"application/json; charset=utf8",success:function(n){comment_edit_callback(n);$("#Comment_Edit_ID").val("");$("#btnComment").val("提交评论")},error:function(n){$("#Comment_new").css("color","").html(n)}}))}function GetAdminLink(){$.ajax({url:"/CommonAjax/AdminLink",data:{contentId:ContentID},type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",success:function(n){$("#side_right_search").after(n)}})}function QueryString(n){var i=document.location.search,r,u,t,f;return i!=null?(r=n+"=",u=i.indexOf(r),u!=-1?(t=i.substring(u+r.length),f=t.indexOf("&"),f!=-1?t.substring(0,f):t):null):null}function NewsLoad(){QueryString("listorder")!=null&&(document.getElementById("selectCommentOrder").options[QueryString("listorder")].selected=!0)}function ctlent2(n){n.ctrlKey&&n.keyCode==13&&doComment()}function comment_callback(n){if(commentCount++,$("#Comment_new").css("color","").html(n.replace(/\n/g,"<br/>")),n.indexOf('<span style="color:red">')<0&&$("#txtContent").val(""),$("#com_count").length>0){var t=parseInt($.trim($("#com_count").text()),10);$("#com_count").text(t+1)}$("#ReplyToCommentId").html("0");comment_btn_reset()}function comment_edit_callback(n){$("#Comment_new").css("color","").html(n);$("#txtContent").val("");comment_btn_reset()}function comment_btn_reset(){$("#btnComment").removeAttr("disabled");$("#btnComment").val("提交评论")}function DelComment(n){var t=confirm("你确认删除该评论么？");t&&$.ajax({url:"/Comment/DelComment",data:'{"contentID":"'+ContentID+'","commentId":'+n+"}",type:"post",dataType:"text",contentType:"application/json; charset=utf8",success:function(n){if($("#span_"+n).css("display","none"),$("#com_count").length>0){var t=parseInt($.trim($("#com_count").text()),10);$("#com_count").text(t>0?t-1:0)}},error:function(n){alert("出现异常："+n)}});return}function SetAuthor(n){$("#txtContent").removeClass("txtContent_bg");$("#ReplyToCommentId").html(n);var t=$("#comment_author_"+n).html();return document.getElementById("txtContent").focus(),document.getElementById("txtContent").value="@"+t+"\n"+document.getElementById("txtContent").value,!1}function QuoteComment(n){var t,i;$("#Comment_new").html("加载引用内容中...").css("color","red").css("margin-left","20px");SetAuthor(n);t=$("#comment_body_"+n).html();t=t.replace(/<br\/?>/ig,"\n");t=t.replace(/<fieldset class=\"comment_quote\">((\w|\W)*?)<\/fieldset>/ig,"[quote]$1[/quote]");t=t.replace(/<[^>]*>/g,"");t.length>300&&(t=t.replace(/<fieldset class=\"comment_quote\">((\w|\W)*?)<\/fieldset>/ig,"[quote]$1[/quote]"),t=t.substring(0,300)+"...");t.length>0&&(t="[quote]"+t+"[/quote]\n");$("#txtContent").focus();i=$("#txtContent").val();$.getScript("http://common.cnblogs.com/script/encoder.js",function(){t=Encoder.htmlDecode(t);$("#txtContent").val(i+t);$("#Comment_new").html("")})}function SetCommentEdit(n){$("#Comment_Edit_ID").val(n);$.ajax({url:"/Comment/GetCommentContentById",data:'{"commentId":"'+n+'"}',type:"post",dataType:"text",contentType:"application/json; charset=utf8",success:function(n){$("#txtContent").val(n);$("#txtContent").removeClass("txtContent_bg");$("#txtContent").focus();$("#btnComment").val("修改评论")},error:function(n){$("#Comment_new").html(n.responseText)}})}function recommend(n,t){$.ajax({url:"/CommonAjax/RecommendNews",data:'{"contentId":'+n+',"isRecommend":'+t+"}",type:"post",dataType:"json",contentType:"application/json; charset=utf8",success:function(n){n.IsSucceed?($("#opt_recommend").css("color","red"),$("#opt_recommend").html(n.Message)):($("#opt_recommend").css("color","red"),$("#opt_recommend").html(n.Message))}})}function hide_publish_news(n,t){return $.ajax({url:"/CommonAjax/AuditNews",data:'{"contentId":'+n+',"lockflag":'+t+',"isEditDate":0}',type:"post",dataType:"json",contentType:"application/json; charset=utf8",success:function(){location.reload()}}),!1}function PutInWz(){var i=460,r=353,u=(screen.width-i)/2,f=(screen.height-r)/2,n=document,t=n.selection?n.selection.type!="None"?n.selection.createRange().text:"":n.getSelection?n.getSelection():"";t.length>200&&(t=t.substring(0,200)+"...");window.open("http://wz.cnblogs.com/create?t="+encodeURIComponent(n.title)+"&u="+encodeURIComponent(n.location.href)+"&c="+encodeURIComponent(t)+"&i=0","_blank","width="+i+",height="+r+",toolbars=0,resizable=1,left="+u+",top="+f)}function go_link(n){window.location=n}function LogShareClick(n){PageClass.LogShareClick(n)}function ToTsina(){var n=$("#news_title a").html(),t="http://news.cnblogs.com/n/"+ContentID+"/",i="#IT新闻# "+n+"，"+t;$.ajax({url:"/service/NewsService.asmx/ToTsina",data:"{content:'"+i+"'}",type:"post",dataType:"json",contentType:"application/json; charset=utf-8",cache:!1,success:function(n){n.d?($("#opt_tsina").css("color","red"),$("#opt_tsina").html("发布成功")):($("#opt_tsina").css("color","red"),$("#opt_tsina").html("发布失败"))},error:function(n){alert(n.responseText)}})}function audit(n,t){var i=0;return t==0&&(i=1),$.ajax({url:"/CommonAjax/AuditNews",data:'{"contentId":'+n+',"lockflag":'+t+',"isEditDate":'+i+"}",type:"post",dataType:"json",contentType:"application/json; charset=utf8",success:function(){$("#span_audit_"+t).css("color","red");$("#span_audit_"+t).html($("#lnk_audit_"+t).html()+"成功")}}),!1}function google_cse_load(){var n=document.createElement("script"),t;n.type="text/javascript";n.src="http://www.google.com.hk/coop/cse/brand?form=cse-search-box&amp;lang=zh-Hans";t=document.getElementById("google_cse_holder");t.parentNode.insertBefore(n,t)}function loadSideAdText_New(){$.ajax({url:"http://ad.cnblogs.com/ad/postmoduletext",type:"get",data:{adModuleId:1},cache:!1,dataType:"jsonp",success:function(n){n?$("#side-ad-text").html(n).css("height","auto"):$("#side-ad-text").hide()}})}function incrementViewCount(n){n&&$.ajax({url:"http://counter.cnblogs.com/news/item/"+n,type:"get",dataType:"script",cache:!0})}function DelNews(n){var t=confirm("是否确认删除该新闻?");return t&&$.ajax({url:"/CommonAjax/DelNews",data:'{"contentId":'+n+"}",type:"post",dataType:"json",contentType:"application/json; charset=utf8",success:function(){window.location.href="http://news.cnblogs.com/"}}),!1}function LoadAjaxNewsInfo(n){$.ajax({url:"/NewsAjax/GetAjaxNewsInfo",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",data:{contentId:n},success:function(t){t&&(commentCount=t.CommentCount,$("#News_CommentCount_Head").text("评论("+t.CommentCount+")"),$("#News_TotalView").text("有"+t.TotalView+"人阅读"),$("#digg_num_"+n).text(t.DiggCount),$("#bury_num_"+n).text(t.BuryCount),t.CommentCount==0?$("#comment_tips").html("还没有人对此新闻发表评论，第一个发表评论。"):$("#comment_tips").html('已经有 <strong><span id="com_count">'+t.CommentCount+"<\/span><\/strong> 位园友对此新闻发表了看法。"))}})}function LoadHotComments(n,t){t>0&&$.ajax({url:"/CommentAjax/GetHotComments",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",data:{contentId:n},success:function(n){n&&($("#best_comment").html(n),$("#hot_comment_block").show())},error:function(n){n.status==500?($("#best_comment").html("加载失败"),$("#hot_comment_block").show()):($("#best_comment").html(n.responseText),$("#hot_comment_block").show())}})}function get_share_links(){}function tsina_a(){var n=screen,t=document,i=encodeURIComponent,r="http://v.t.sina.com.cn/share/share.php?",u=t.location.href,f=["url=",i(u),"&title=",i(t.title.replace("_IT新闻_博客园","")),"&appkey=2924220432"].join("");window.open([r,f].join(""),"mb",["toolbar=0,status=0,resizable=1,width=620,height=450,left=",(n.width-620)/2,",top=",(n.height-450)/2].join(""))||(u.href=[r,f].join(""))}function tqq_a(){var n=screen,t=document,i=encodeURIComponent,r="http://v.t.qq.com/share/share.php?",u=t.location.href,f=["url=",i(u),"&title=",i(t.title.replace("_IT新闻_博客园","")),"&appkey=caffbb4e48c14ec1aa159cf61470d76a"].join("");window.open([r,f].join(""),"mb",["toolbar=0,status=0,resizable=1,width=620,height=450,left=",(n.width-620)/2,",top=",(n.height-450)/2].join(""))||(u.href=[r,f].join(""))}function tsohu_a(){var i=screen,r=document,n=encodeURIComponent,u="http://t.sohu.com/third/post.jsp?",f=r.location.href,t=["&url=",n(f),"&title=",n(r.title.replace("_IT新闻_博客园","")),"&content=","utf-8","&pic=",n(t||"")].join("");window.open([u,t].join(""),"mb",["toolbar=0,status=0,resizable=1,width=660,height=470,left=",(i.width-660)/2,",top=",(i.height-470)/2].join(""))||(f.href=[u,t].join(""))}function ShareToTsina(){/Firefox/.test(navigator.userAgent)?setTimeout(tsina_a,0):tsina_a()}function ShareToTqq(){/Firefox/.test(navigator.userAgent)?setTimeout(tqq_a,0):tqq_a()}function ShareToTsohu(){/Firefox/.test(navigator.userAgent)?setTimeout(tsohu_a,0):tsohu_a()}function ShareToTweixin(){var n=document.location.href;n=n.replace("/n/","/m/n/");n.substring(n.length-1)=="/"&&(n=n.substring(0,n.length-1));var t=380,i=330,r=(window.screen.availHeight-30-i)/2,u=(window.screen.availWidth-10-t)/2,f=Math.random()*999+1;window.open("http://news.cnblogs.com/share_weixin.html?url="+encodeURIComponent(n)+"&random="+f,"_blank","location=no,top="+r+",left="+u+", toolbar=no, directories=no, titlebar=yes, status=no, menubar=no, scrollbars=no,status=no, resizable=no, copyhistory=no, width="+t+", height="+i+"")}function ask(n){n!=""&&window.open("http://v.t.sina.com.cn/share/share.php?searchPic=false&title="+decodeURIComponent(n)+"&url="+location.href+"&source=博客园&sourceUrl=http://news.cnblogs.com&content=utf-8&appkey=2970785141","_blank","height=515, width=598, toolbar=no, menubar=no, scrollbars=auto, resizable=yes, location=no, status=yes")}$(function(){try{loadSideAdText_New();GetAdminLink()}catch(n){}})